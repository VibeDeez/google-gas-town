# ==============================================================================
# Gas Town tmux Configuration - Optimized for Antigravity IDE
# ==============================================================================
#
# This configuration is designed to work well within the Antigravity IDE
# integrated terminal, with mouse support, 256 colors, and a clean status bar.
#
# Usage:
#   tmux -f tmux/gastown.tmux.conf new-session -s gastown
#
# Or set in config.yaml:
#   tmux:
#     config: tmux/gastown.tmux.conf

# ==============================================================================
# Core Settings
# ==============================================================================

# Use 256 colors (Antigravity terminal supports this)
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable mouse support (essential for IDE integration)
set -g mouse on

# Start window/pane numbering at 1 (more intuitive)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Reduce escape time (better for VI mode in IDE)
set -sg escape-time 10

# Enable focus events (helps with IDE integration)
set -g focus-events on

# ==============================================================================
# Key Bindings
# ==============================================================================

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes with Alt+Arrow (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Shift+Arrow
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 2
bind -n S-Down resize-pane -D 2

# Synchronize panes (broadcast to all)
bind S setw synchronize-panes \; display-message "Sync #{?synchronize-panes,ON,OFF}"

# Quick window navigation
bind -n C-PageUp previous-window
bind -n C-PageDown next-window

# ==============================================================================
# Status Bar (Gas Town Theme)
# ==============================================================================

# Status bar position
set -g status-position bottom

# Status bar colors
set -g status-style "bg=#1a1b26,fg=#a9b1d6"

# Left side: Session name
set -g status-left-length 30
set -g status-left "#[bg=#7aa2f7,fg=#1a1b26,bold] ğŸ— #S #[bg=#1a1b26] "

# Right side: Agent count, Time
set -g status-right-length 60
set -g status-right "#[fg=#7dcfff]ğŸ #{pane_current_command} #[fg=#565f89]â”‚ #[fg=#bb9af7]%H:%M #[fg=#565f89]â”‚ #[fg=#9ece6a]%Y-%m-%d "

# Window status
set -g window-status-format "#[fg=#565f89] #I:#W "
set -g window-status-current-format "#[bg=#3d59a1,fg=#c0caf5,bold] #I:#W "

# Pane borders
set -g pane-border-style "fg=#3b4261"
set -g pane-active-border-style "fg=#7aa2f7"

# Message style
set -g message-style "bg=#7aa2f7,fg=#1a1b26,bold"

# ==============================================================================
# Gas Town Layouts
# ==============================================================================

# Layout: Mayor + 2 Polecats
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                    â”‚   Polecat 1  â”‚
# â”‚      Mayor         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚                    â”‚   Polecat 2  â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

bind M-m \
    split-window -h -p 35 \; \
    split-window -v \; \
    select-pane -t 1 \; \
    send-keys "# Mayor Pane" Enter \; \
    select-pane -t 2 \; \
    send-keys "# Polecat 1" Enter \; \
    select-pane -t 3 \; \
    send-keys "# Polecat 2" Enter \; \
    select-pane -t 1

# Layout: Swarm (2x2 grid)
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  Polecat 1   â”‚  Polecat 2   â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  Polecat 3   â”‚  Polecat 4   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

bind M-s \
    split-window -h \; \
    split-window -v \; \
    select-pane -t 1 \; \
    split-window -v \; \
    select-layout tiled \; \
    select-pane -t 1

# Layout: Dashboard + Workers
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚           Dashboard            â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚   P1   â”‚   P2   â”‚     P3       â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

bind M-d \
    split-window -v -p 60 \; \
    select-pane -t 2 \; \
    split-window -h \; \
    split-window -h \; \
    select-layout main-horizontal \; \
    select-pane -t 1 \; \
    send-keys "./scripts/monitor_swarm.sh" Enter

# ==============================================================================
# Copy Mode (VI-style)
# ==============================================================================

setw -g mode-keys vi

# Enter copy mode
bind Enter copy-mode

# VI-style selection
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# ==============================================================================
# Tips for Antigravity IDE
# ==============================================================================
#
# 1. Open the Antigravity integrated terminal
# 2. Start a session: tmux -f path/to/gastown.tmux.conf new -s gastown
# 3. Use layouts: Prefix + Alt+m (Mayor), Alt+s (Swarm), Alt+d (Dashboard)
# 4. Broadcast: Prefix + S to sync all panes
# 5. Navigate: Alt+Arrows to move between panes (no prefix needed)
#
# ==============================================================================
